<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>R.K.S Scientific Calculator</title>

  <!-- Bootstrap 5 -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <style>
    :root{
      --bg:#0f1226;
      --card:#171a36;
      --accent:#6c5ce7;
      --accent-2:#00d1b2;
      --text:#e6e8ff;
      --muted:#a6abcf;
      --key:#22264d;
      --key-2:#1b1f3b;
      --op:#2f3aa3;
      --op-2:#27429b;
      --warn:#e74c3c;
      --ok:#00c853;
      --shadow: 0 10px 25px rgba(0,0,0,.35);
    }
    html,body{background:linear-gradient(135deg,#0b0e22 0%, #111538 50%, #0b0e22 100%); color:var(--text);}
    .brand-bar{
      background:linear-gradient(120deg,var(--accent),#8a72ff 50%, var(--accent-2));
      color:white;
      border-radius:1rem 1rem 0 0;
      padding:14px 18px;
      display:flex; align-items:center; justify-content:space-between;
      box-shadow: var(--shadow);
      letter-spacing:.5px;
      text-transform: uppercase;
      font-weight: 700;
    }
    .brand-title small{display:block; font-size:.7rem; opacity:.85; letter-spacing:1.5px}
    .calc-card{
      max-width: 420px;
      margin: 28px auto;
      background: var(--card);
      border-radius:1rem;
      box-shadow: var(--shadow);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.08);
    }
    .display{
      background: radial-gradient(1200px 350px at 50% -20%, rgba(255,255,255,.15), transparent 60%),
                  linear-gradient(180deg,#1b1f3f, #141736);
      padding:18px;
      border-bottom:1px solid rgba(255,255,255,.05);
    }
    .sub-display{
      color:var(--muted);
      min-height:1.2em;
      font-size:.9rem;
      letter-spacing:.4px;
      margin-bottom:6px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .main-display{
      font-size: 1.9rem;
      font-weight: 700;
      color: var(--text);
      text-align: right;
      letter-spacing:.3px;
      height: 2.4em;
      line-height: 2.4em;
      background: transparent;
      border: none;
      width: 100%;
      outline: none;
    }
    .keypad{
      padding: 12px;
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap:10px;
      background: linear-gradient(180deg, #16193a, #121534);
    }
    .btn-key{
      background: var(--key);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 10px;
      padding: 12px 8px;
      font-weight: 700;
      letter-spacing:.3px;
      box-shadow: 0 6px 14px rgba(0,0,0,.25);
      transition: transform .05s ease, filter .15s ease;
      user-select: none;
    }
    .btn-key:active{ transform: translateY(1px) scale(.995); filter: brightness(1.08); }
    .btn-op{ background: linear-gradient(180deg, var(--op), var(--op-2)); }
    .btn-fn{ background: var(--key-2); }
    .btn-ac{ background: linear-gradient(180deg, #c0392b, #a93226); }
    .btn-eq{ background: linear-gradient(180deg, #00c853, #00a249); }
    .btn-wide{ grid-column: span 2; }
    .badge-mode{
      background: rgba(0,0,0,.15);
      border: 1px solid rgba(255,255,255,.35);
      padding: 3px 8px;
      border-radius: 999px;
      font-size:.75rem;
      font-weight:800;
      letter-spacing:1px;
    }
    .status{
      color: var(--muted);
      font-size: .8rem;
      display:flex; gap:10px; align-items:center; justify-content:flex-end;
    }
    .status .dot{
      width:8px; height:8px; border-radius:50%;
      background: #7f8fa6; display:inline-block; margin-right:6px;
      box-shadow: 0 0 8px rgba(127,143,166,.6);
    }
    .status .dot.on{ background: #00d1b2; box-shadow: 0 0 8px rgba(0,209,178,.8); }
    .footer-note{
      text-align:center; color:var(--muted); font-size:.8rem; margin-top:12px; margin-bottom:16px;
    }
    @media (max-width: 420px){
      .keypad{ gap:8px; }
      .btn-key{ padding:10px 6px; font-size:.95rem; }
      .main-display{ font-size:1.7rem; }
    }
  </style>
</head>
<body>
  <div class="calc-card">
    <div class="brand-bar">
      <div class="brand-title">
        R.K.S
        <small>Casio‑style scientific calculator</small>
      </div>
      <div class="d-flex align-items-center gap-2">
        <span id="modeBadge" class="badge-mode">DEG</span>
      </div>
    </div>

    <div class="display">
      <div id="subDisplay" class="sub-display"></div>
      <input id="display" class="main-display" type="text" inputmode="numeric" autocomplete="off" spellcheck="false" />
      <div class="status">
        <span><span id="memDot" class="dot"></span>MEM</span>
        <span><span id="ansDot" class="dot"></span>ANS</span>
      </div>
    </div>

    <div class="keypad">
      <!-- Memory + Mode -->
      <button class="btn-key btn-fn" data-action="mc">MC</button>
      <button class="btn-key btn-fn" data-action="mr">MR</button>
      <button class="btn-key btn-fn" data-action="mplus">M+</button>
      <button class="btn-key btn-fn" data-action="mminus">M−</button>
      <button class="btn-key btn-fn" data-action="deg">DEG</button>
      <button class="btn-key btn-fn" data-action="rad">RAD</button>

      <!-- Top ops -->
      <button class="btn-key btn-ac" data-action="ac">AC</button>
      <button class="btn-key btn-fn" data-action="del">DEL</button>
      <button class="btn-key btn-fn" data-insert="(">(</button>
      <button class="btn-key btn-fn" data-insert=")">)</button>
      <button class="btn-key btn-fn" data-action="percent">%</button>
      <button class="btn-key btn-fn" data-action="inv">1/x</button>

      <!-- Row -->
      <button class="btn-key" data-insert="7">7</button>
      <button class="btn-key" data-insert="8">8</button>
      <button class="btn-key" data-insert="9">9</button>
      <button class="btn-key btn-op" data-insert="÷">÷</button>
      <button class="btn-key btn-fn" data-action="sqrt">√</button>
      <button class="btn-key btn-fn" data-action="sq">x²</button>

      <!-- Row -->
      <button class="btn-key" data-insert="4">4</button>
      <button class="btn-key" data-insert="5">5</button>
      <button class="btn-key" data-insert="6">6</button>
      <button class="btn-key btn-op" data-insert="×">×</button>
      <button class="btn-key btn-fn" data-insert="^">xʸ</button>
      <button class="btn-key btn-fn" data-action="fact">n!</button>

      <!-- Row -->
      <button class="btn-key" data-insert="1">1</button>
      <button class="btn-key" data-insert="2">2</button>
      <button class="btn-key" data-insert="3">3</button>
      <button class="btn-key btn-op" data-insert="-">−</button>
      <button class="btn-key btn-fn" data-action="sin">sin</button>
      <button class="btn-key btn-fn" data-action="cos">cos</button>

      <!-- Row -->
      <button class="btn-key" data-insert="0">0</button>
      <button class="btn-key" data-insert=".">.</button>
      <button class="btn-key btn-fn" data-action="exp">EXP</button>
      <button class="btn-key btn-op" data-insert="+">+</button>
      <button class="btn-key btn-fn" data-action="tan">tan</button>
      <button class="btn-key btn-fn" data-action="pm">±</button>

      <!-- Row -->
      <button class="btn-key btn-fn" data-action="ln">ln</button>
      <button class="btn-key btn-fn" data-action="log">log</button>
      <button class="btn-key btn-fn" data-action="pi">π</button>
      <button class="btn-key btn-fn" data-action="e">e</button>
      <button class="btn-key btn-fn" data-action="ans">Ans</button>
      <button class="btn-key btn-eq" data-action="eq">=</button>
    </div>

    <div class="footer-note">Designed for projects — R.K.S by Rohit</div>
  </div>

  <script>
    // State
    const display = document.getElementById('display');
    const subDisplay = document.getElementById('subDisplay');
    const modeBadge = document.getElementById('modeBadge');
    const memDot = document.getElementById('memDot');
    const ansDot = document.getElementById('ansDot');

    let ANGLE_MODE = 'DEG';  // 'DEG' | 'RAD'
    let MEMORY = 0;
    let ANS = 0;

    const FN = {
      toRad: (x) => x * Math.PI / 180,
      sin: (x) => ANGLE_MODE === 'DEG' ? Math.sin(FN.toRad(x)) : Math.sin(x),
      cos: (x) => ANGLE_MODE === 'DEG' ? Math.cos(FN.toRad(x)) : Math.cos(x),
      tan: (x) => ANGLE_MODE === 'DEG' ? Math.tan(FN.toRad(x)) : Math.tan(x),
      log10: (x) => (Math.log10 ? Math.log10(x) : Math.log(x) / Math.LN10),
      fact: (n) => {
        if (!isFinite(n)) return NaN;
        if (n < 0) return NaN;
        if (Math.floor(n) !== n) return NaN;
        if (n > 170) return Infinity; // beyond JS Number safe factorial
        let r = 1;
        for (let i = 2; i <= n; i++) r *= i;
        return r;
      }
    };

    function setDisplay(val) {
      display.value = val;
    }
    function append(str) {
      setDisplay((display.value || '') + str);
    }
    function isOperator(ch){
      return ['+','-','×','÷','/','*','^'].includes(ch);
    }
    function extractLastTerm(expr){
      // Returns [startIndex, endIndexExclusive] of last term (number or parenthesized group)
      if (!expr) return [0,0];
      let i = expr.length - 1;
      // skip trailing spaces
      while (i>=0 && /\s/.test(expr[i])) i--;
      // Handle closing parenthesis group
      if (expr[i] === ')'){
        let depth = 1; i--;
        while (i>=0){
          if (expr[i] === ')') depth++;
          else if (expr[i] === '(') depth--;
          if (depth === 0) break;
          i--;
        }
        const start = Math.max(0,i);
        return [start, expr.length];
      }
      // Otherwise scan until an operator or start
      while (i>=0){
        const ch = expr[i];
        if (isOperator(ch) || ch === '(' || ch === ',') break;
        i--;
      }
      return [i+1, expr.length];
    }
    function wrapLastTerm(wrapperFn){ // wrapperFn(termString) => newString
      const s = display.value || '';
      const [a,b] = extractLastTerm(s);
      const term = s.slice(a,b);
      if (!term) return;
      const repl = wrapperFn(term);
      setDisplay(s.slice(0,a) + repl + s.slice(b));
    }

    // Actions
    function doAC(){ setDisplay(''); subDisplay.textContent=''; }
    function doDEL(){
      setDisplay((display.value||'').slice(0,-1));
    }
    function doPercent(){
      wrapLastTerm(t => `(${t}/100)`);
    }
    function doInv(){
      wrapLastTerm(t => `(1/(${t}))`);
    }
    function doSqrt(){
      // Insert function form for consistency
      wrapLastTerm(t => `√(${t})`);
    }
    function doSquare(){
      wrapLastTerm(t => `(${t})^2`);
    }
    function doPower(){ append('^'); }
    function doFactorial(){
      wrapLastTerm(t => `FN.fact(${t})`);
    }
    function doPM(){
      wrapLastTerm(t => {
        // Toggle sign if already wrapped as (-...)
        if (t.startsWith('(-') && t.endsWith(')')) return t.slice(2,-1);
        return `(-${t})`;
      });
    }
    function doTrig(name){
      wrapLastTerm(t => `${name}(${t})`);
    }
    function doLn(){ wrapLastTerm(t => `ln(${t})`); }
    function doLog(){ wrapLastTerm(t => `log(${t})`); }
    function doPi(){ append('π'); }
    function doE(){ append('ℯ'); } // visually 'e', we map to Math.E later
    function doEXP(){ append('e'); } // scientific notation, e.g., 3e5
    function doAns(){ append('Ans'); }

    function setMode(mode){
      ANGLE_MODE = mode;
      modeBadge.textContent = mode;
    }

    function sanitizeAndTransform(exprRaw){
      let expr = exprRaw;

      // Replace unicode operators
      expr = expr.replace(/×/g,'*').replace(/÷/g,'/');

      // Replace power ^
      expr = expr.replace(/\^/g, '**');

      // Functions -> JS
      expr = expr.replace(/\b√\s*\(/g, 'Math.sqrt(');
      expr = expr.replace(/\bln\s*\(/g, 'Math.log(');
      expr = expr.replace(/\blog\s*\(/g, 'FN.log10(');
      expr = expr.replace(/\bsin\s*\(/g, 'FN.sin(');
      expr = expr.replace(/\bcos\s*\(/g, 'FN.cos(');
      expr = expr.replace(/\btan\s*\(/g, 'FN.tan(');

      // Constants (ensure we don't break scientific notation like 3e5)
      expr = expr.replace(/π/g, 'Math.PI');
      expr = expr.replace(/ℯ/g, 'Math.E'); // Euler's constant button
      expr = expr.replace(/\bAns\b/g, String(ANS));

      // Safety: allow only certain characters after replacements
      const ok = /^[0-9+\-*/().,eE\s]*$|FN\.|Math\./;
      // We'll do a conservative check per token:
      const suspicious = /[^0-9+\-*/().,eE\sA-Za-z_\.]/.test(expr);
      if (suspicious) throw new Error('Invalid characters');

      return expr;
    }

    function compute(){
      const exprRaw = (display.value || '').trim();
      if (!exprRaw) return;
      const expr = sanitizeAndTransform(exprRaw);
      subDisplay.textContent = exprRaw + ' =';
      try{
        // Evaluate in a limited scope using Function and explicit bindings
        const result = (function(FN){
          return Function('FN', 'Math', '"use strict"; return ( ' + expr + ' );')(FN, Math);
        })(FN);

        if (typeof result === 'number' && isFinite(result)){
          ANS = result;
          setDisplay(String(result));
          ansDot.classList.add('on');
        } else {
          setDisplay('Error');
        }
      } catch(e){
        setDisplay('Error');
      }
    }

    // Memory functions
    function currentValueOrNaN(){
      const v = display.value.trim();
      if (!v) return NaN;
      try{
        const expr = sanitizeAndTransform(v);
        const val = Function('FN','Math','"use strict"; return ( '+expr+' );')(FN, Math);
        return Number(val);
      }catch{ return NaN; }
    }
    function mc(){ MEMORY = 0; memDot.classList.remove('on'); }
    function mr(){
      if (!display.value || display.value === '0') setDisplay(String(MEMORY));
      else append(String(MEMORY));
    }
    function mplus(){
      const v = currentValueOrNaN();
      if (!isNaN(v)){ MEMORY += v; memDot.classList.add('on'); }
    }
    function mminus(){
      const v = currentValueOrNaN();
      if (!isNaN(v)){ MEMORY -= v; memDot.classList.add('on'); }
    }

    // Wiring
    document.querySelectorAll('.btn-key').forEach(btn=>{
      const ins = btn.getAttribute('data-insert');
      const act = btn.getAttribute('data-action');
      btn.addEventListener('click', ()=>{
        if (ins !== null){ append(ins); return; }
        switch(act){
          case 'ac': doAC(); break;
          case 'del': doDEL(); break;
          case 'percent': doPercent(); break;
          case 'inv': doInv(); break;
          case 'sqrt': doSqrt(); break;
          case 'sq': doSquare(); break;
          case 'fact': doFactorial(); break;
          case 'pm': doPM(); break;
          case 'sin': doTrig('sin'); break;
          case 'cos': doTrig('cos'); break;
          case 'tan': doTrig('tan'); break;
          case 'ln': doLn(); break;
          case 'log': doLog(); break;
          case 'pi': doPi(); break;
          case 'e': doE(); break;
          case 'exp': doEXP(); break;
          case 'ans': doAns(); break;
          case 'deg': setMode('DEG'); break;
          case 'rad': setMode('RAD'); break;
          case 'eq': compute(); break;
          case 'mc': mc(); break;
          case 'mr': mr(); break;
          case 'mplus': mplus(); break;
          case 'mminus': mminus(); break;
        }
      });
    });

    // Keyboard support
    window.addEventListener('keydown', (e)=>{
      const k = e.key;
      if (/^[0-9]$/.test(k)) append(k);
      else if (k === '.') append('.');
      else if (k === '+') append('+');
      else if (k === '-') append('-');
      else if (k === '*' ) append('×');
      else if (k === '/') append('÷');
      else if (k === '^') append('^');
      else if (k === '(') append('(');
      else if (k === ')') append(')');
      else if (k === 'Backspace') doDEL();
      else if (k === 'Delete') doAC();
      else if (k === 'Enter' || k === '='){ compute(); }
    });

    // Initial
    setMode('DEG');
    setDisplay('');
  </script>
</body>
</html>
